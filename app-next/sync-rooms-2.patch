commit 116313784628e38e35497ba98b46d310d5e87172
Author: r0hitsharma <rs@rohit.sh>
Date:   Sun Feb 2 17:13:00 2025 +0100

    Save play progress.

diff --git a/app-next/app/room/[id]/page.jsx b/app-next/app/room/[id]/page.jsx
index ea9df6a..93ee28a 100644
--- a/app-next/app/room/[id]/page.jsx
+++ b/app-next/app/room/[id]/page.jsx
@@ -38,7 +38,7 @@ export default async function RoomPage({ params }) {
           <div className="grid grid-cols-1 lg:grid-cols-5 gap-4">
             <div className="col-span-3 aspect-w-16 aspect-h-9">
               <div className="w-full h-full rounded-lg shadow-lg">
-                <Video id={room.id} url={room.video_url} />
+                <Video id={room.id} url={room.video_url} cursor={room.cursor}/>
               </div>
             </div>
             <div className="col-span-2 bg-gray-900 text-gray-300 rounded-lg shadow-lg p-4 h-full flex flex-col">
diff --git a/app-next/components/Video.jsx b/app-next/components/Video.jsx
index 10016dc..9c2ce02 100644
--- a/app-next/components/Video.jsx
+++ b/app-next/components/Video.jsx
@@ -1,7 +1,33 @@
 'use client';
 
-import ReactPlayer from 'react-player';
+import { useEffect, useRef } from 'react';
+import ReactPlayer from 'react-player/youtube';
+import { getRoom, updateRoom } from "@/roomActions";
 
-export function Video ({ id, url }) {
-  return <ReactPlayer url={url} width={"100%"} height={"100%"}/>;
+export function Video ({ id, url, cursor }) {
+  const playedSeconds = useRef(cursor);
+
+  async function refreshRoom(){
+    const room = await getRoom(id);
+    playedSeconds.current = room.cursor;
+  }
+
+  useEffect(() => {
+    refreshRoom();
+  }, []);
+
+  function saveRoom() {
+    updateRoom({ id, cursor: playedSeconds.current });
+  }
+
+  return <ReactPlayer url={url} width={"100%"} height={"100%"} onProgress={x => {
+    playedSeconds.current = parseInt(x.playedSeconds);
+    saveRoom();
+  }} controls  config={{
+    youtube: {
+      playerVars: {
+        start: playedSeconds.current
+      }
+    }
+  }}/>;
 }
\ No newline at end of file
diff --git a/app-next/roomActions.js b/app-next/roomActions.js
index 76c768d..e7fe760 100644
--- a/app-next/roomActions.js
+++ b/app-next/roomActions.js
@@ -26,6 +26,17 @@ export async function getRoom(roomId) {
   }
 }
 
+export async function updateRoom(room) {
+  try {
+    await connection('room').where({id: room.id}).update({
+      cursor: room.cursor,
+    });
+  }  catch (error) {
+    console.error("Error updating room:", error);
+    throw new Error("Failed to update room");
+  }
+}
+
 export async function sendMessage(roomId, content) {
   try {
     const cookieStore = cookies();
